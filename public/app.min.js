/* Minified on Sun Mar 09 2014 21:31:33 */window.Puls3={},Puls3.Views={},Puls3.Collections={},Puls3.Models={},Puls3.Routers={},window.app={},window.routers={},window.plugs={},window.views={},window.collections={},Puls3.Models.Article=Backbone.Model.extend({url:"/articles/"}),Puls3.Collections.Articles=Backbone.Collection.extend({model:Puls3.Models.Article,url:"/articles/",name:"articles"}),Puls3.Views.App=Backbone.View.extend({events:{"click .publicar":"showForm","submit form":"createArticle","click .logo":"navigateHome"},initialize:function(a){this.$el=a},navigateHome:function(){Backbone.history.navigate("/",{trigger:!0})},showForm:function(a){a.preventDefault(),this.$el.find("form").slideToggle()},createArticle:function(a){a.preventDefault();var b=$("input[name=titulo]").val(),c=$("input[name=autor]").val(),d=$("input[name=tag]").val(),e={title:b,image:"/img/img3.jpg",user:c,tag:d,votes:0};console.log(e.user);var f=new Puls3.Models.Article(e);f.save(),this.$el.find("form input[type=text]").val(),this.$el.find("form").slideToggle()}}),Puls3.Views.Article=Backbone.View.extend({events:{"click .acciones .votos .up":"upvote","click .acciones .votos .down":"downvote",click:"navigate","click .descripcion .detalles .tag":"hola"},tagName:"article",className:"post",initialize:function(){var a=this;this.model.on("change",function(){"articleSingle"===window.app.state?a.extendedRender():a.render()}),window.routers.base.on("route:root",function(){a.$el.css("display",""),a.render()}),window.routers.base.on("route:articleSingle",function(){window.app.article==a.model.get("id")?a.extendedRender():a.$el.hide()}),this.template=swig.compile($("#article-template").html()),this.extendedTemplate=swig.compile($("#article-extended-template").html())},navigate:function(){Backbone.history.navigate("/article/"+this.model.get("id"),{trigger:!0})},hola:function(){var a=this.model.get("tag");alert("Click a "+a)},downvote:function(a){a.preventDefault(),a.stopPropagation(),console.log(this.model.get("votes"));var b=parseInt(this.model.get("votes"),10);this.model.set("votes",--b),this.model.save()},upvote:function(a){a.preventDefault(),a.stopPropagation();var b=parseInt(this.model.get("votes"),10);this.model.set("votes",++b),this.model.save()},extendedRender:function(){var a=this.model.toJSON(),b=this.extendedTemplate(a);this.$el.html(b)},render:function(){var a=this.model.toJSON(),b=this.template(a);this.$el.html(b)}}),Puls3.Routers.Base=Backbone.Router.extend({routes:{"":"root","article/:id":"articleSingle"},initialize:function(){},root:function(){console.log("Estamos en el root de nuestra aplicaci√≥n"),window.app.state="root",window.app.article=null},articleSingle:function(a){console.log("Estamos en articleSingle"),window.app.state="articleSingle",window.app.article=a}}),$(document).ready(function(){console.log("main.js loaded"),window.views.app=new Puls3.Views.App($("body")),window.routers.base=new Puls3.Routers.Base,window.ponyExpress=new PonyExpress({io:window.location.origin}),window.ponyExpress.bind("connect",function(){window.plugs.article=new PonyExpress.BackbonePlug({collection:window.collections.articles})}),window.collections.articles=new Puls3.Collections.Articles,window.collections.articles.on("add",function(a){var b=new Puls3.Views.Article({model:a});b.render(),$(".posts").prepend(b.$el)});var a=window.collections.articles.fetch();a.done(function(){Backbone.history.start({root:"/",pushState:!0})})});